# UMIC-seq2 suite for analysis of Oxford Nanopore data

The `scripts` folder contains python scripts for the UMIC-seq2 analysis pipeline shown in the figure below.
You will need to use third party software (red boxes in the figure below) as well as the provided scripts here (blue boxes) to process the raw data. 

![pipeline](../figs/umic_seq_pipeline.jpeg)

**Extraction of UMIs from basecalled Nanopore reads for clustering**
Use the following commands to run the script 'UMI_extract.py': 
``` 
-T Number of threads to execute in parallel. Defaults to CPU count.  
-v Gives Version
-i Provide basecalled reads in fastq format.  
-o Specify the name of the UMI output fasta file.  
--probe A short sequence (eg 50 bp) adjacent to the UMI in fasta format.  
--umi_loc Location of UMI in reference to the probe. Upstream (up) or downstream (down).  
--umi_len Length of the UMI to be extracted.  
--min_probe_score Minimal alignment score of probe for processing. Defaults to length of probe sequence.  
```

**Using the mmseqs2 output to generate a .fasta files for individual clusters**  
Use the following commands to run the script 'tsv2fasta.py':  
Positional argument: 'clusterfile' Provide MMseqs2 output file (as .tsv)  
--sizethreshs Low and high thresholds for cluster sizes. Defaults to 1 1000.  
--splitfile If a read file (fasta/fastq) is provided here, individual fasta files per cluster will be generated.  
--similarityfile If a read file (fasta/fastq) is provided here, <similaritysamplesize> clusters will be analysed for internal cluster similarity.  
--similaritysamplesize Sample size for within cluster similarity analysis. Defaults to 500.  

**An example for a python script generating an .sh file that can be used to automate consensus generation 'clustering_automator.py'**
To automate consensus generation via medaka for clusterfiles generated using the 'tsv2fasta.py' script the 'clustering_automator.py' script can be used to generate a .sh file that to iteratively call all tools neccesary for consensus generation (minimap2, racon, mini_align, medaka consensus, medaka variant and the vcf2fasta python script.

**'vcf2fasta.py' for generating a .fasta file from the vcf file generated by medaka variant**
Can be used in automation by using the 'clustering_automator.py' script

**Generating a variant identifyer file for DiMSum**
Use the following arguments to run 'VIF_generator.py':  
--probe_UMI_down 'A short sequence (eg 14 bp) beginning 4 bp downstream of the UMI in fasta format.'  
--probe_UMI_up 'A short sequence (eg 14 bp) ending 4 bp upstream of the UMI in fasta format.'  
--probe_frame_down 'A short sequence (eg 10 bp) flanking the frame (downstream) in fasta format.  
--probe_frame_up '(eg 10 bp) flanking the frame (upstream) in fasta format.  
--clusterfolder 'path to clusterfolder generated after using clustering_automator.py'  